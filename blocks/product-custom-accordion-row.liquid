{% comment %}
  Product Custom Accordion Row
  Used within product custom tabs to create dynamic accordion content
{% endcomment %}

{%- liquid
  assign block_settings = block.settings
-%}

<accordion-custom
  {% if block_settings.open_by_default %}
    open-by-default-on-desktop
    open-by-default-on-mobile
  {% endif %}
>
  <details
    class="details"
    data-testid="product-accordion-details"
    {% if block_settings.open_by_default %}
      open
    {% endif %}
    {{ block.shopify_attributes }}
  >
    <summary class="details__header">
      {% if block_settings.icon != 'none' %}
        <span class="svg-wrapper {{ block_settings.icon }} details__icon">
          {{ block_settings.icon | append: '.svg' | inline_asset_content }}
        </span>
      {% endif %}
      
      <span class="accordion-row-heading">
        {% if block_settings.heading != blank %}
          {{ block_settings.heading | escape }}
        {% else %}
          Product Information
        {% endif %}
      </span>
      
      <span class="svg-wrapper icon-caret icon-animated">
        {{ 'icon-caret.svg' | inline_asset_content }}
      </span>
      <span class="svg-wrapper icon-plus">
        {{ 'icon-plus.svg' | inline_asset_content }}
      </span>
    </summary>

    <div class="details-content">
      {% if block_settings.content_type == 'custom' and block_settings.custom_content != blank %}
        <div class="rte">{{ block_settings.custom_content }}</div>
      {% elsif block_settings.content_type == 'product_description' %}
        {% if product.description != blank %}
          <div class="rte">{{ product.description }}</div>
        {% else %}
          <p>No product description available.</p>
        {% endif %}
      {% elsif block_settings.content_type == 'metafield' and block_settings.metafield_namespace != blank and block_settings.metafield_key != blank %}
        {%- liquid
          assign namespace = block_settings.metafield_namespace
          assign key = block_settings.metafield_key
          assign metafield_value = product.metafields[namespace][key]
        -%}
        {% if metafield_value != blank %}
          <div class="rte">{{ metafield_value.value }}</div>
        {% else %}
          <p>No information available for this product.</p>
        {% endif %}
      {% elsif block_settings.content_type == 'specifications' %}
        <div class="product-basic-specifications">
          <p><strong>Product Type:</strong> {{ product.type | default: 'Not specified' }}</p>
          <p><strong>Vendor:</strong> {{ product.vendor | default: 'Not specified' }}</p>
          {% if product.variants.first.sku != blank %}
            <p><strong>SKU:</strong> {{ product.variants.first.sku }}</p>
          {% endif %}
        </div>
      {% elsif block_settings.content_type == 'care_instructions' %}
        <div class="product-care-instructions">
          {% if product.metafields.custom.care_instructions != blank %}
            <div class="rte">{{ product.metafields.custom.care_instructions }}</div>
          {% else %}
            <p>Follow standard care instructions for this type of product.</p>
          {% endif %}
        </div>
      {% else %}
        {% content_for 'blocks' %}
      {% endif %}
    </div>
  </details>
</accordion-custom>

<style>
  .details__icon {
    width: 1.2rem;
    height: 1.2rem;
    margin-right: var(--spacing-xs);
    flex-shrink: 0;
  }

  .accordion-row-heading {
    flex-grow: 1;
  }

  .details__header {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
  }
</style>

{% schema %}
{
  "name": "Product Accordion Row",
  "blocks": [
    {
      "type": "@theme"
    },
    {
      "type": "@app"
    }
  ],
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Product Information"
    },
    {
      "type": "select",
      "id": "content_type",
      "label": "Content type",
      "options": [
        {
          "value": "custom",
          "label": "Custom content"
        },
        {
          "value": "product_description",
          "label": "Product description"
        },
        {
          "value": "metafield",
          "label": "Product metafield"
        },
        {
          "value": "specifications",
          "label": "Basic specifications"
        },
        {
          "value": "care_instructions",
          "label": "Care instructions"
        }
      ],
      "default": "custom"
    },
    {
      "type": "richtext",
      "id": "custom_content",
      "label": "Custom content",
      "info": "Only used when content type is 'Custom content'"
    },
    {
      "type": "text",
      "id": "metafield_namespace",
      "label": "Metafield namespace",
      "info": "Only used when content type is 'Product metafield'"
    },
    {
      "type": "text",
      "id": "metafield_key",
      "label": "Metafield key",
      "info": "Only used when content type is 'Product metafield'"
    },
    {
      "type": "select",
      "id": "icon",
      "label": "Icon",
      "options": [
        {
          "value": "none",
          "label": "None"
        },
        {
          "value": "icon-info",
          "label": "Info"
        },
        {
          "value": "icon-inventory",
          "label": "Inventory"
        },
        {
          "value": "icon-external",
          "label": "External"
        },
        {
          "value": "icon-checkmark",
          "label": "Checkmark"
        }
      ],
      "default": "icon-info"
    },
    {
      "type": "checkbox",
      "id": "open_by_default",
      "label": "Open by default",
      "default": false
    }
  ]
}
{% endschema %}
