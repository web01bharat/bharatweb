{% assign block_settings = block.settings %}

<accordion-custom
  {% if block_settings.open_by_default %}
    open-by-default-on-desktop
    open-by-default-on-mobile
  {% endif %}
>
  <details
    class="details"
    data-testid="accordion-details"
    {% if block_settings.open_by_default %}
      open
    {% endif %}
    {{ block.shopify_attributes }}
  >
    <summary class="details__header">
      {% render 'icon-or-image',
        icon: block_settings.icon,
        image_upload: block_settings.image_upload,
        width: block_settings.width,
        class_name: 'details__icon'
      %}
      {{ block_settings.heading }}
      <span class="svg-wrapper icon-caret icon-animated">
        {{- 'icon-caret.svg' | inline_asset_content -}}
      </span>
      <span class="svg-wrapper icon-plus">
        {{- 'icon-plus.svg' | inline_asset_content -}}
      </span>
    </summary>

    <div class="details-content">
      {% if block_settings.content_type == 'custom' and block_settings.custom_content != blank %}
        <div class="rte">{{ block_settings.custom_content }}</div>
      {% elsif block_settings.content_type == 'metafield' and block_settings.metafield_namespace != blank and block_settings.metafield_key != blank %}
        {%- liquid
          assign namespace = block_settings.metafield_namespace
          assign key = block_settings.metafield_key
        -%}
        {% if product and product.metafields[namespace][key] != blank %}
          <div class="rte">{{ product.metafields[namespace][key].value }}</div>
        {% elsif page and page.metafields[namespace][key] != blank %}
          <div class="rte">{{ page.metafields[namespace][key].value }}</div>
        {% elsif blog and blog.metafields[namespace][key] != blank %}
          <div class="rte">{{ blog.metafields[namespace][key].value }}</div>
        {% elsif article and article.metafields[namespace][key] != blank %}
          <div class="rte">{{ article.metafields[namespace][key].value }}</div>
        {% elsif shop.metafields[namespace][key] != blank %}
          <div class="rte">{{ shop.metafields[namespace][key].value }}</div>
        {% else %}
          <p>No information available.</p>
        {% endif %}
      {% elsif block_settings.content_type == 'product_description' and product %}
        {% if product.description != blank %}
          <div class="rte">{{ product.description }}</div>
        {% else %}
          <p>No product description available.</p>
        {% endif %}
      {% elsif block_settings.content_type == 'page_content' and page %}
        {% if page.content != blank %}
          <div class="rte">{{ page.content }}</div>
        {% else %}
          <p>No page content available.</p>
        {% endif %}
      {% elsif block_settings.content_type == 'article_content' and article %}
        {% if article.content != blank %}
          <div class="rte">{{ article.content }}</div>
        {% else %}
          <p>No article content available.</p>
        {% endif %}
      {% else %}
        {%- comment -%} Default to blocks content for backward compatibility {%- endcomment -%}
        {% content_for 'blocks' %}
      {% endif %}
    </div>
  </details>
</accordion-custom>

{% stylesheet %}
  .details__icon {
    height: auto;
    margin-inline-end: var(--margin-xs);
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Accordion Row",
  "tag": null,
  "blocks": [
    {
      "type": "@theme"
    },
    {
      "type": "@app"
    }
  ],
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Frequently Asked Question"
    },
    {
      "type": "select",
      "id": "content_type",
      "label": "Content Type",
      "options": [
        {
          "value": "blocks",
          "label": "Blocks (Default)"
        },
        {
          "value": "custom",
          "label": "Custom Content"
        },
        {
          "value": "metafield",
          "label": "Dynamic Metafield"
        },
        {
          "value": "product_description",
          "label": "Product Description"
        },
        {
          "value": "page_content",
          "label": "Page Content"
        },
        {
          "value": "article_content",
          "label": "Article Content"
        }
      ],
      "default": "blocks",
      "info": "Choose how to populate the accordion content"
    },
    {
      "type": "richtext",
      "id": "custom_content",
      "label": "Custom Content",
      "info": "Only used when content type is 'Custom Content'"
    },
    {
      "type": "text",
      "id": "metafield_namespace",
      "label": "Metafield Namespace",
      "info": "Only used when content type is 'Dynamic Metafield'. Example: 'custom' or 'global'"
    },
    {
      "type": "text",
      "id": "metafield_key",
      "label": "Metafield Key",
      "info": "Only used when content type is 'Dynamic Metafield'. Example: 'faq_answer'"
    },
    {
      "type": "checkbox",
      "id": "open_by_default",
      "label": "Open by default",
      "default": false
    },
    {
      "type": "header",
      "content": "Icon"
    },
    {
      "type": "select",
      "id": "icon",
      "label": "Icon",
      "options": [
        {
          "value": "none",
          "label": "None"
        },
        {
          "value": "apple",
          "label": "Apple"
        },
        {
          "value": "arrow",
          "label": "Arrow"
        },
        {
          "value": "banana",
          "label": "Banana"
        },
        {
          "value": "bottle",
          "label": "Bottle"
        },
        {
          "value": "box",
          "label": "Box"
        },
        {
          "value": "carrot",
          "label": "Carrot"
        },
        {
          "value": "chat_bubble",
          "label": "Chat Bubble"
        },
        {
          "value": "check_box",
          "label": "Check Box"
        },
        {
          "value": "clipboard",
          "label": "Clipboard"
        },
        {
          "value": "dairy",
          "label": "Dairy"
        },
        {
          "value": "dairy_free",
          "label": "Dairy Free"
        },
        {
          "value": "dryer",
          "label": "Dryer"
        },
        {
          "value": "eye",
          "label": "Eye"
        },
        {
          "value": "fire",
          "label": "Fire"
        },
        {
          "value": "gluten_free",
          "label": "Gluten Free"
        },
        {
          "value": "heart",
          "label": "Heart"
        },
        {
          "value": "iron",
          "label": "Iron"
        },
        {
          "value": "leaf",
          "label": "Leaf"
        },
        {
          "value": "leather",
          "label": "Leather"
        },
        {
          "value": "lightning_bolt",
          "label": "Lightning Bolt"
        },
        {
          "value": "lipstick",
          "label": "Lipstick"
        },
        {
          "value": "lock",
          "label": "Lock"
        },
        {
          "value": "map_pin",
          "label": "Map Pin"
        },
        {
          "value": "nut_free",
          "label": "Nut Free"
        },
        {
          "value": "pants",
          "label": "Pants"
        },
        {
          "value": "paw_print",
          "label": "Paw Print"
        },
        {
          "value": "pepper",
          "label": "Pepper"
        },
        {
          "value": "perfume",
          "label": "Perfume"
        },
        {
          "value": "plane",
          "label": "Plane"
        },
        {
          "value": "plant",
          "label": "Plant"
        },
        {
          "value": "price_tag",
          "label": "Price Tag"
        },
        {
          "value": "question_mark",
          "label": "Question Mark"
        },
        {
          "value": "recycle",
          "label": "Recycle"
        },
        {
          "value": "return",
          "label": "Return"
        },
        {
          "value": "ruler",
          "label": "Ruler"
        },
        {
          "value": "serving_dish",
          "label": "Serving Dish"
        },
        {
          "value": "shirt",
          "label": "Shirt"
        },
        {
          "value": "shoe",
          "label": "Shoe"
        },
        {
          "value": "silhouette",
          "label": "Silhouette"
        },
        {
          "value": "bluesky",
          "label": "Bluesky"
        },
        {
          "value": "facebook",
          "label": "Facebook"
        },
        {
          "value": "instagram",
          "label": "Instagram"
        },
        {
          "value": "linkedin",
          "label": "LinkedIn"
        },
        {
          "value": "pinterest",
          "label": "Pinterest"
        },
        {
          "value": "snapchat",
          "label": "Snapchat"
        },
        {
          "value": "spotify",
          "label": "Spotify"
        },
        {
          "value": "threads",
          "label": "Threads"
        },
        {
          "value": "tiktok",
          "label": "TikTok"
        },
        {
          "value": "tumblr",
          "label": "Tumblr"
        },
        {
          "value": "twitter",
          "label": "Twitter"
        },
        {
          "value": "vimeo",
          "label": "Vimeo"
        },
        {
          "value": "youtube",
          "label": "YouTube"
        },
        {
          "value": "whatsapp",
          "label": "WhatsApp"
        },
        {
          "value": "snowflake",
          "label": "Snowflake"
        },
        {
          "value": "star",
          "label": "Star"
        },
        {
          "value": "stopwatch",
          "label": "Stopwatch"
        },
        {
          "value": "truck",
          "label": "Truck"
        },
        {
          "value": "washing",
          "label": "Washing"
        }
      ],
      "default": "none"
    },
    {
      "type": "image_picker",
      "id": "image_upload",
      "label": "Image Icon"
    },
    {
      "type": "range",
      "id": "width",
      "label": "Icon Width",
      "min": 12,
      "max": 200,
      "step": 2,
      "unit": "px",
      "default": 20
    }
  ],
  "presets": [
    {
      "name": "Accordion Row",
      "settings": {
        "heading": "Frequently Asked Question",
        "content_type": "custom",
        "custom_content": "<p>Enter your answer here.</p>"
      }
    }
  ]
}
{% endschema %}
